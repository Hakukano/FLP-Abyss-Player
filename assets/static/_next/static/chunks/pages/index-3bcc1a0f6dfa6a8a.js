(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(7756)}])},7756:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return C}});var l=a(5893),s=a(7294),i=a(2004),o=a(1415),n=a(44),c=a(8680),r=a(4033);function d(e){let[t,a]=(0,s.useState)(""),[i,o]=(0,s.useState)(1),[d,h]=(0,s.useState)(5),[u,m]=(0,s.useState)([]),[f,p]=(0,s.useState)(0),[y,w]=(0,s.useState)(!1),[x,g]=(0,s.useState)(new Map),_=async t=>{w(!0);try{let a=await e.playlistRemote.read({id:t});e.setPlaylistData(a)}finally{w(!1)}},j=async(a,l)=>{w(!0);try{let s=await e.playlistRemote.list({search:t,filter:[],offset:(a-1)*l,length:l});m(s.data),p(s.count);let i=new Map;for(let t of s.data)try{let a=await e.playlistLocal.read({remote_id:t.id});i.set(t.id,a.id)}catch(e){}g(i)}finally{w(!1)}},b=e=>{o(e),j(e,d)},v=(e,t)=>{h(e),o(t),j(t,e)};return(0,s.useEffect)(()=>{j(i,d)},[]),(0,l.jsxs)("div",{className:"w-full h-full flex flex-col space-y-1",children:[(0,l.jsxs)("div",{className:"w-full h-6 grid grid-rows-1 grid-cols-12",children:[(0,l.jsx)("input",{className:"col-span-11",type:"text",placeholder:"Press ENTER to search...",value:t,style:{color:"#222"},onChange:e=>a(e.target.value),onKeyDown:e=>{"Enter"===e.key&&j(i,d)}}),(0,l.jsxs)("div",{className:"col-span-1 grid grid-rows-1 grid-cols-2",children:[(0,l.jsx)(r.Z,{className:"h-full col-span-1",style:{color:"#222",backgroundColor:"#ee2222"},onClick:async()=>{for(let t of u)try{await e.playlistLocal.delete({remote_id:t.id})}catch(e){}await j(i,d)}}),(0,l.jsx)(c.Z,{className:"h-full col-span-1",style:{color:"#222",backgroundColor:"#22ee22"},onClick:async()=>{for(let t of u)try{try{await e.playlistLocal.read({remote_id:t.id})}catch(a){await e.playlistLocal.create({path:t.path,mime_type:t.mime_type,remote_id:t.id})}}catch(e){}await j(i,d)}})]})]}),(0,l.jsx)("div",{id:"scrollable-pl-remote",className:"h-full flex overflow-auto flex-col",children:(0,l.jsx)("div",{className:"w-full h-auto",children:(0,l.jsx)(n.ZP,{columns:[{omit:!0,name:"ID",selector:e=>e.id},{name:"Full Path",selector:e=>e.path,button:!0,width:"95%",cell:e=>(0,l.jsx)("button",{onClick:async()=>{await _(e.id)},children:e.path})},{omit:!0,name:"MIME Type",selector:e=>e.mime_type},{name:"",button:!0,width:"5%",cell:t=>x.has(t.id)?(0,l.jsx)(r.Z,{className:"w-full h-full",onClick:async()=>{try{await e.playlistLocal.delete({remote_id:t.id}),await j(i,d)}catch(e){}}}):(0,l.jsx)(c.Z,{className:"w-full h-full",onClick:async()=>{try{await e.playlistLocal.create({path:t.path,mime_type:t.mime_type,remote_id:t.id}),await j(i,d)}catch(e){}}})}],data:u,progressPending:y,pagination:!0,paginationServer:!0,paginationPerPage:d,paginationTotalRows:f,paginationRowsPerPageOptions:[5,10,15,20],onChangeRowsPerPage:v,onChangePage:b})})})]})}var h=a(8533),u=a(6610),m=a(3245);function f(e){let[t,a]=(0,s.useState)(""),[i,o]=(0,s.useState)([]),[n,c]=(0,s.useState)(!0),d=async t=>{{let a=await e.playlistLocal.read({id:t});e.setPlaylistData({id:a.remote_id,path:a.path,mime_type:a.mime_type})}},f=async a=>{let l=await e.playlistLocal.list({search:t,filter:[],offset:0,length:a});o(l.data),c(a<l.count)};return(0,s.useEffect)(()=>{f(i.length+20)},[]),(0,l.jsxs)("div",{className:"w-full h-full flex flex-col space-y-1",children:[(0,l.jsx)("input",{className:"w-full",type:"text",placeholder:"Press ENTER to search...",value:t,style:{color:"#222"},onChange:e=>a(e.target.value),onKeyDown:e=>{"Enter"===e.key&&f(i.length+20)}}),(0,l.jsx)("div",{id:"scrollable-pl-local",className:"w-full h-full flex overflow-auto flex-col",children:(0,l.jsx)(h.Z,{className:"w-full flex flex-col",next:()=>{f(i.length+20)},hasMore:n,dataLength:i.length,loader:(0,l.jsx)("h4",{children:"Loading..."}),scrollableTarget:"scrollable-pl-local",children:i.map((t,a)=>(0,l.jsxs)("div",{className:"w-full grid grid-rows-1 grid-cols-12 gap-1",children:[(0,l.jsx)("button",{className:"m-0.5 border border-solid border-black text-left col-span-11",style:{color:"#222"},onClick:async()=>{await d(t.id)},children:t.path}),(0,l.jsxs)("div",{className:"col-span-1 grid grid-rows-3 grid-cols-1",children:[(0,l.jsx)(u.Z,{className:"row-span-1 text-center max-h-8",style:{color:"#222"},onClick:async()=>{try{await e.playlistLocal.move({id:t.id,step:-1}),await f(i.length)}catch(e){}}}),(0,l.jsx)(r.Z,{className:"row-span-1 text-center max-h-8",style:{color:"#222"},onClick:async()=>{try{await e.playlistLocal.delete({id:t.id}),await f(i.length)}catch(e){}}}),(0,l.jsx)(m.Z,{className:"row-span-1 text-center max-h-8",style:{color:"#222"},onClick:async()=>{try{await e.playlistLocal.move({id:t.id,step:1}),await f(i.length)}catch(e){}}})]})]},a))})})]})}var p=a(2913),y=a(7292),w=a(5073),x=a(682),g=a(6249);function _(e){return(0,l.jsx)("nav",{className:"w-full bg-white border-gray-200 dark:bg-gray-900",style:{height:"5vh"},children:(0,l.jsxs)("div",{className:"h-full flex items-center justify-between p-1",children:[(0,l.jsx)(p.Z,{className:"h-full",onClick:async()=>{let t=e.playlistData;if(t){let a=await e.playlistLocal.step({current:t.id,step:-1});e.setPlaylistData({id:a.remote_id,path:a.path,mime_type:a.mime_type})}}}),(0,l.jsx)(w.Z,{className:"h-full",onClick:()=>e.setShowPlaylistRemote(!e.showPlaylistRemote)}),(0,l.jsx)(x.Z,{className:"h-full",onClick:()=>e.setShowPlaylistLocal(!e.showPlaylistLocal)}),(0,l.jsx)(g.Z,{className:"h-full",onClick:()=>{!0===confirm("Purge local playlist?")&&e.playlistLocal.purge()}}),(0,l.jsx)(y.Z,{className:"h-full",onClick:async()=>{let t=e.playlistData;if(t){let a=await e.playlistLocal.step({current:t.id,step:1});e.setPlaylistData({id:a.remote_id,path:a.path,mime_type:a.mime_type})}}})]})})}class j{async read(e){let t=await fetch("/playlists/".concat(e.id));if(t.ok)return await t.json();throw{status:t.status,message:await t.text()}}async list(e){let t=await fetch("/playlists?".concat(new URLSearchParams({filter:e.filter.join(","),search:e.search,offset:e.offset.toString(),length:e.length.toString()})));if(t.ok)return await t.json();throw{status:t.status,message:await t.text()}}}var b=a(9632),v=a(2748),N=a(9520);class k extends N.ZP{constructor(){super("flp-abyss-player-client"),this.version(1).stores({playlist_locals:"++id, data"})}}let P=new k;class L{async create(e){let t=await P.playlist_locals.get(1);if(!t)throw{cause:"db",message:"not found"};let a=t.data.length;return t.data.push(e),await P.playlist_locals.put(t,1),a}async read(e){let t=await P.playlist_locals.get(1);if(!t)throw{cause:"db",message:"not found"};if(void 0!==e.id){let a=t.data[e.id];return{id:e.id,path:a.path,mime_type:a.mime_type,remote_id:a.remote_id}}if(void 0!==e.remote_id){let a=t.data.map((e,t)=>({id:t,path:e.path,mime_type:e.mime_type,remote_id:e.remote_id})).find(t=>t.remote_id===e.remote_id);if(!a)throw{cause:"query",message:"not found"};return a}throw{cause:"query",message:"bad request"}}async delete(e){let t=await P.playlist_locals.get(1);if(!t)throw{cause:"db",message:"not found"};if(void 0!==e.id)t.data.splice(e.id,1);else if(void 0!==e.remote_id){let a=t.data.findIndex(t=>t.remote_id===e.remote_id);if(a<0)throw{cause:"query",message:"not found"};t.data.splice(a,1)}else throw{cause:"query",message:"bad request"};await P.playlist_locals.put(t,1)}async list(e){let t=await P.playlist_locals.get(1);if(!t)throw{cause:"db",message:"not found"};let a=t.data.map((e,t)=>({id:t,path:e.path,mime_type:e.mime_type,remote_id:e.remote_id}));if(e.search){let t=new b.Z(a,{keys:["path"]}).search(e.search),l=t.length,s=t.slice(e.offset,e.offset+e.length).map(e=>e.item);return{count:l,data:s}}{let t=a.length,l=a.slice(e.offset,e.offset+e.length);return{count:t,data:l}}}async count(){let e=await P.playlist_locals.get(1);if(!e)throw{cause:"db",message:"not found"};return e.data.length}async purge(){await P.playlist_locals.put({id:1,data:[]},1)}async step(e){let t=await P.playlist_locals.get(1);if(!t)throw{cause:"db",message:"not found"};let a=t.data.findIndex(t=>t.remote_id===e.current)||0,l=a+e.step,s=Math.min(Math.max(l,0),t.data.length-1),i=t.data[s];return{id:s,path:i.path,mime_type:i.mime_type,remote_id:i.remote_id}}async move(e){let t=await P.playlist_locals.get(1);if(!t)throw{cause:"db",message:"not found"};(0,v.Y)(t.data,e.id,Math.min(Math.max(e.id+e.step,0),t.data.length-1)),await P.playlist_locals.put(t,1)}constructor(){P.playlist_locals.get(1).then(e=>{e||P.playlist_locals.put({id:1,data:[]},1)})}}function C(){let e=new j,t=new L,[a,n]=(0,s.useState)(null),[c,r]=(0,s.useState)(!1),[h,u]=(0,s.useState)(!1);return(0,l.jsxs)("main",{className:"flex flex-col w-full h-full items-center justify-between p-2 space-y-2",children:[(0,l.jsx)(_,{playlistLocal:t,playlistData:a,setPlaylistData:n,showPlaylistRemote:c,setShowPlaylistRemote:r,showPlaylistLocal:h,setShowPlaylistLocal:u}),(0,l.jsx)("div",{className:"w-full h-full",children:a?a.mime_type.startsWith("image/")?(0,l.jsx)("div",{className:"w-full text-center",style:{height:"88vh"},children:(0,l.jsx)("img",{className:"w-full h-full align-middle",style:{objectFit:"contain",overflow:"hidden"},src:"/playlists/".concat(a.id,"/stream"),alt:a.path})}):(0,l.jsx)(i.Z,{width:"100%",height:"88vh",url:"/playlists/".concat(a.id,"/stream"),controls:!0}):(0,l.jsx)(l.Fragment,{})}),c?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"absolute justify-center items-center fixed inset-0 z-50 outline-none focus:outline-none",style:{width:"90%",height:"95vh",left:"5%"},children:(0,l.jsx)("div",{className:"relative w-full h-full",children:(0,l.jsxs)("div",{className:"h-full border-0 rounded-lg shadow-lg relative flex flex-col w-full bg-white outline-none focus:outline-none",children:[(0,l.jsxs)("div",{className:"flex items-start justify-between p-1 border-b border-solid border-slate-200 rounded-t",children:[(0,l.jsx)("h3",{className:"text-2xl text-black font-semibold",children:"Remote Playlist"}),(0,l.jsx)(o.Z,{className:"h-8 p-1 ml-auto bg-transparent border-0 text-black float-right text-3xl leading-none font-semibold outline-none focus:outline-none",onClick:()=>r(!1)})]}),(0,l.jsx)("div",{className:"relative p-2 w-full flex min-h-0",children:(0,l.jsx)(d,{playlistRemote:e,setPlaylistData:n,playlistLocal:t})})]})})}),(0,l.jsx)("div",{className:"opacity-25 fixed inset-0 z-40 bg-black"})]}):(0,l.jsx)(l.Fragment,{}),h?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"absolute justify-center items-center fixed inset-0 z-50 outline-none focus:outline-none",style:{width:"90%",height:"95vh",left:"5%"},children:(0,l.jsx)("div",{className:"relative w-full h-full",children:(0,l.jsxs)("div",{className:"h-full border-0 rounded-lg shadow-lg relative flex flex-col w-full bg-white outline-none focus:outline-none",children:[(0,l.jsxs)("div",{className:"flex items-start justify-between p-1 border-b border-solid border-slate-200 rounded-t",children:[(0,l.jsx)("h3",{className:"text-2xl text-black font-semibold",children:"Local Playlist"}),(0,l.jsx)(o.Z,{className:"h-8 p-1 ml-auto bg-transparent border-0 text-black float-right text-3xl leading-none font-semibold outline-none focus:outline-none",onClick:()=>u(!1)})]}),(0,l.jsx)("div",{className:"relative p-2 w-full flex min-h-0",children:(0,l.jsx)(f,{playlistLocal:t,setPlaylistData:n})})]})})}),(0,l.jsx)("div",{className:"opacity-25 fixed inset-0 z-40 bg-black"})]}):(0,l.jsx)(l.Fragment,{})]})}}},function(e){e.O(0,[620,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);